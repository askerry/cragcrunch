{% extends "base.j2" %}

{% block content %}


<br>
<div class="contenthead">
	<div id="contenttitle">{{user['name']}} </div>                                  
	<div id="details">{%if user['gender']!=''%}{{user['gender']}},{%endif%} {%if user['gender']!=''%}{{ user['age'] }}{%endif%} {{user['mainarea_name']}}, {{user['country']}}</div>
</div>
<div class='usercontent'>
	<div id="profile">
		Climbs {{user['climbstyles']}}. View climbing record on <a href="http://{{user['url']}}">MountainProject</a>.<span id="hiddenid">{{user['climberid']}}</span>
		
		<div id="plotbox">
		<div class="plotrow">
		<div id="plotcontainer0">
		<script>
			var plotdata='{{plotdata[0] | safe}}';
			var jsondata=JSON.parse(plotdata);
			var chart = new Highcharts.Chart(jsondata);
		</script>
		</div>
		<div id="plotcontainer1">
		<script>
			var plotdata='{{plotdata[1] | safe}}';
			var jsondata=JSON.parse(plotdata);
			var chart = new Highcharts.Chart(jsondata);
		</script>
		</div>
		</div>
		<div>
		<div class="plotrow">
		<div id="plotcontainer2">
		<script>
			var plotdata='{{plotdata[2] | safe}}';
			var jsondata=JSON.parse(plotdata);
			var chart = new Highcharts.Chart(jsondata);
		</script>
		</div>
		<div id="plotcontainer3">
		<script>
			var plotdata='{{plotdata[3] | safe}}';
			var jsondata=JSON.parse(plotdata);
			var chart = new Highcharts.Chart(jsondata);
		</script>
		</div>
		</div>
		</div>
		</div>
		</div>
	<div id="userrecs">
		<div id="formbox">
		<div id="checkgroup">
			<input type="checkbox" id="sportcheck" value='Sport' checked >&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
			<input type="checkbox" id="tradcheck" value='Trad' checked >&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
			<input type="checkbox" id="bouldercheck" value='Boulder' checked>
		</div>

		<div class="sliderdiv">
			<div class="caption"><b>Adjust Difficulty</b></div>
	        <div class="sliderlabel">Easier</div>
	  		<input id='gradeslider' type="range" min="-25" max="25" value="0" step="2" />
	  		<div class="sliderlabel">Harder</div>
		 </div>
		 <div class="buttondiv" onclick="refreshrecs();"><img id="refreshbutton" src="../static/img/refresh.jpg" alt="refresh"></div>

		 </div>
		<div id="reccontainer">
		<h4>Top climbs for you in 
		<select id="dropdown" onchange="refreshrecs()">
		{%  for key in areas.keys() %}
			{% if key == defaultarea %}
				<option value="{{ key }}" selected> {{areas[key]}} </option>
			{% else %}
				<option value="{{ key }}"> {{areas[key]}} </option>
			{% endif %}
		{% endfor %}
		</select>
		</h4>
		<div id="recbox">
		      {% for rec in recs %}
					<div class="recroute"><a href="../view/climb{{ rec['climbid']}}">{{rec['name']}}</a></div>                               
					<div class="tagline">{{rec['style']}}, {{rec['grade']}} .......... {{ rec['mainarea_name'] }}, {{ rec['region'] }}</div>
		      {% endfor %}
		</div>
		</div>
	</div>
	</div>
</div>

<script>
			function updaterec(data) {
	      		console.log('got data!')
	      		newrecs=data['recs']
	      	    console.log(newrecs)
				for(r in newrecs){
					var rec=newrecs[r]
					var climbname=rec['name'];
					var climbid=rec['climbid'];
					var climbgrade=rec['grade'];
					var climbarea=rec['mainarea_name'];
					var climbstyle=rec['style'];
					var climbregion=rec['region'];
					str='<div class="recroute"><a href="../view/climb'+climbid.toString()+'">'+climbname+'</a></div>'
					$('#recbox').append(str);
					//str='<a href="../view/climb'+climbid.toString()+'">'+climbname+'</a>'
					//$('.recroute').append(str);
					str='<div class="tagline">'+climbstyle+', ' +climbgrade+' .......... '+climbarea+', '+climbregion+'</div>'
					$('#recbox').append(str);
				}
				$('#recbox').show();
	    		};


    		//adjust recs based on user selection
    		function refreshrecs(){
    		   $('#recbox').empty();
			   $.ajax({
			      type: 'GET',
			      url: '/refreshrecs', // This is the url that will be requested
			      data: {areaid: $('#dropdown').val(), userid:{{user['climberid']}}, gradeshift:$('#gradeslider').val(), sportcheck: $("#sportcheck").prop('checked'), tradcheck: $("#tradcheck").prop('checked'), bouldercheck: $("#bouldercheck").prop('checked')},
			      success: updaterec,
			      dataType: 'JSON'
			    });
				};
</script>

{% endblock %}