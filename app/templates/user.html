{% extends "base.j2" %}

{% block content %}


<div class="row">
	<div id="contenttitle" class="col-md-4">{{user['name']}} </div>                                  
	<div id="details" class="col-md-8">{%if user['gender']!=''%}{{user['gender']}},{%endif%} {%if user['gender']!=''%}{{ user['age'] }}{%endif%} {{user['mainarea_name']}}, {{user['country']}}</div>
</div>

<hr class="headline">

<div class="col-md-7" id="userrecs">
	<div id="reccontainer">
		<span class="boost">Top climbs for {{user['name']}} in </span>
		<select id="areadropdown" class="defaultselect" onchange="refreshrecs()">
		{%  for key in areas.keys() %}
			{% if key == defaultarea %}
				<option value="{{ key }}" selected> {{areas[key]}} </option>
			{% else %}
				<option value="{{ key }}"> {{areas[key]}} </option>
			{% endif %}
		{% endfor %}
		</select>
		<hr>
		<div id="recbox">
		      {% for rec in recs %}
					<div class="recroute"><a href="../view/climb{{ rec['climbid']}}">{{rec['name']}}</a></div>                               
					<div class="tagline">{{rec['style']}}, {{rec['grade']}} .......... <a href="../view/climb{{ rec['mainarea']}}">{{ rec['mainarea_name'] }}</a>, {{ rec['region'] }}</div>
		      {% endfor %}
		</div>
		</div>
			<div id="formbox">
		<div id="checkgroup">
			<input type="checkbox" id="sportcheck" value='Sport' checked onchange="refreshrecs();">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
			<input type="checkbox" id="tradcheck" value='Trad' checked onchange="refreshrecs();">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
			<input type="checkbox" id="bouldercheck" value='Boulder' checked onchange="refreshrecs();">
		</div>

		<div class="sliderdiv">
	        <div class="sliderlabel">Easier</div>
	  		<input id='gradeslider' type="text" class="span2" data-slider-min="-24" data-slider-max="24" data-slider-step="1" data-slider-value="1" data-slider-orientation="horizontal" data-slider-handle="square" data-slider-tooltip="show" onchange="refreshrecs();">
	  		<div class="sliderlabel">Harder</div>
		</div>
	 </div>
</div>

<div class="row">
	<div class="col-md-5" id="profile">
		<div id="plotbox">
				<div id="plotcontainer0">
					<script>
						var plotdata='{{plotdata[0] | safe}}';
						var jsondata=JSON.parse(plotdata);
						var chart = new Highcharts.Chart(jsondata);
					</script>
				</div>
		</div>
	<span class="miniboost">View {{user['name']}}'s full climbing record on <a href="http://{{user['url']}}">MountainProject</a>.</span>
	</div>
</div>
<script>
			
			function updaterec(data) {
	      		newrecs=data['recs']
	      	    console.log(newrecs)
				for(r in newrecs){
					var rec=newrecs[r]
					var climbname=rec['name'];
					var climbid=rec['climbid'];
					var climbgrade=rec['grade'];
					var climbarea=rec['mainarea'];
					var climbarea_name=rec['mainarea_name'];
					var climbstyle=rec['style'];
					var climbregion=rec['region'];
					str='<div class="recroute"><a href="../view/climb'+climbid.toString()+'">'+climbname+'</a></div>'
					$('#recbox').append(str);
					//str='<a href="../view/climb'+climbid.toString()+'">'+climbname+'</a>'
					//$('.recroute').append(str);
					var climbarealink='<a href="view/area'+climbarea+'">'+climbarea_name+'</a>'
					str='<div class="tagline">'+climbstyle+', ' +climbgrade+' .......... '+climbarealink+', '+climbregion+'</div>'
					$('#recbox').append(str);
				}
				$('#recbox').show();
	    		};


    		//adjust recs based on user selection
    		function refreshrecs(){
    		   $('#recbox').empty();
			   $.ajax({
			      type: 'GET',
			      url: '/refreshrecs', // This is the url that will be requested
			      data: {areaid: $('#areadropdown').val(), userid:{{user['climberid']}}, gradeshift:$('#gradeslider').slider('getValue'), sportcheck: $("#sportcheck").prop('checked'), tradcheck: $("#tradcheck").prop('checked'), bouldercheck: $("#bouldercheck").prop('checked')},
			      success: updaterec,
			      dataType: 'JSON'
			    });
				};

			$(document).ready(function(){
				$('#gradeslider').on('slide', refreshrecs);
			});

</script>

{% endblock %}