{% extends "base.j2" %}

{% block content %}


<div id="contenthead" class="row">
	<div id="contenttitle" class="col-md-6">{{user['name']}} </div>                                  
	<div id="details" class="col-md-6"> <p></p> {%if user['gender']!=''%}{{user['gender']}},{%endif%} {%if user['gender']!=''%}{{ user['age'] }}{%endif%} {{user['mainarea_name']}}, {{user['country']}}</div>
</div>
<div class="row">
	<div class="col-md-8" id="profile">
	{%if user['climbstyles']!='nan'%} Climbs {{user['climbstyles']}}. {% endif %}View climbing record on <a href="http://{{user['url']}}">MountainProject</a>.
		<div id="plotbox">
				<div id="plotcontainer0">
					<script>
						var plotdata='{{plotdata[0] | safe}}';
						var jsondata=JSON.parse(plotdata);
						var chart = new Highcharts.Chart(jsondata);
					</script>
				</div>
		</div>
	</div>
	<div class="col-md-4" id="userrecs">
		<div id="reccontainer">
		<h4>Top climbs for you in 
		<select id="dropdown" onchange="refreshrecs()">
		{%  for key in areas.keys() %}
			{% if key == defaultarea %}
				<option value="{{ key }}" selected> {{areas[key]}} </option>
			{% else %}
				<option value="{{ key }}"> {{areas[key]}} </option>
			{% endif %}
		{% endfor %}
		</select>
		</h4>
		<div id="recbox">
		      {% for rec in recs %}
					<div class="recroute"><a href="../view/climb{{ rec['climbid']}}">{{rec['name']}}</a></div>                               
					<div class="tagline">{{rec['style']}}, {{rec['grade']}} .......... <a href="../view/climb{{ rec['mainarea']}}">{{ rec['mainarea_name'] }}</a>, {{ rec['region'] }}</div>
		      {% endfor %}
		</div>
		</div>
			<div id="formbox">
		<div id="checkgroup">
			<input type="checkbox" id="sportcheck" value='Sport' checked >&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
			<input type="checkbox" id="tradcheck" value='Trad' checked >&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
			<input type="checkbox" id="bouldercheck" value='Boulder' checked>
		</div>

		<div class="sliderdiv">
	        <div class="sliderlabel">Easier</div>
	  		<input id='gradeslider' type="range" min="-25" max="25" value="0" step="2" />
	  		<div class="sliderlabel">Harder</div>
	  		<div class="buttondiv" onclick="refreshrecs();"><img id="refreshbutton" src="../static/img/refresh.jpg" alt="refresh"></div>
		 </div>

		 </div>
	</div>
</div>
<script>
			function updaterec(data) {
	      		console.log('got data!')
	      		newrecs=data['recs']
	      	    console.log(newrecs)
				for(r in newrecs){
					var rec=newrecs[r]
					var climbname=rec['name'];
					var climbid=rec['climbid'];
					var climbgrade=rec['grade'];
					var climbarea=rec['mainarea'];
					var climbarea_name=ec['mainarea_name'];
					var climbstyle=rec['style'];
					var climbregion=rec['region'];
					str='<div class="recroute"><a href="../view/climb'+climbid.toString()+'">'+climbname+'</a></div>'
					$('#recbox').append(str);
					//str='<a href="../view/climb'+climbid.toString()+'">'+climbname+'</a>'
					//$('.recroute').append(str);
					var climbarealink='<a href="view/area'+climbarea+'">'+mainareaname+'</a>'
					str='<div class="tagline">'+climbstyle+', ' +climbgrade+' .......... '+climbarealink+', '+climbregion+'</div>'
					$('#recbox').append(str);
				}
				$('#recbox').show();
	    		};


    		//adjust recs based on user selection
    		function refreshrecs(){
    		   $('#recbox').empty();
			   $.ajax({
			      type: 'GET',
			      url: '/refreshrecs', // This is the url that will be requested
			      data: {areaid: $('#dropdown').val(), userid:{{user['climberid']}}, gradeshift:$('#gradeslider').val(), sportcheck: $("#sportcheck").prop('checked'), tradcheck: $("#tradcheck").prop('checked'), bouldercheck: $("#bouldercheck").prop('checked')},
			      success: updaterec,
			      dataType: 'JSON'
			    });
				};
</script>

{% endblock %}